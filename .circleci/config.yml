version: 2.1
jobs:
  build:
    docker:
      - image: circleci/php:7.1-node-browsers
    steps:
      - checkout
      - run: sudo apt update
      - run: sudo apt install -y sqlite3
      - run: sudo docker-php-ext-install pdo_sqlite pdo gd
      - run: docker-php-ext-enable pdo_sqlite
      - run: composer install
      - run: npm install
      - run: touch storage/testing.sqlite
      - run: php artisan migrate --env=testing --force
      - run: ./vendor/bin/phpunit
